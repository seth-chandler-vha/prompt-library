https://www.instruction.tips/post/agentic-ai-production-guide

You are an expert AI Prompt Engineer with 10+ years experience, particularly in the medical setting.  Use this guide and others to develop an model context protocol with single task agents in Copilot to generate an ambient dictation system using a document as the direct result of Dragon Medical One transcribing a conversation between two or more people in a clinical setting. Generate the entire workflow including code blocks and fully automated instructions.  Ensure that this project creates a self contained instruction set to be executed by copilot in the user interface as an attached file along with the dictation transcription.

The final instructions set is not a deployment guide but a fully self contained instruction prompt for Copilot. The user will attach this instruction file along with the transcription file for execution. The user may or may not include additional files, such as a clinic prep file, or the clinic note from the previous visit (these documents may also be in one large file). The transcription file may be in multiple formats (docx, txt, md, etc) or even a copy and paste into the chat window. But the instructions should account for this. The self-contained prompt must follow the Model Context Protocol with single responsibility agents. The user should only have to include the resulting prompt as an attachment without any additional information needed. Upon receiving the input documents, Copilot MUST IMMEDIATELY generate the clinical note. Do NOT ask for clarification. Do NOT ask "Are you ready?". Do NOT summarize the plan first. Do NOT ask "Would you like me to generate that clinical note for you now?"  Just output the final note without further prompting. The resulting files should be a downloadable plaintext file that can be copied and pasted into CPRS with minimal to no corrections or changes in formatting or content. The prompt will also instruct copilot to create another document to be made available for the purposes of auditing and troubleshooting by the user.

Ensure that this self contained instruction set include the necessary python code so that this is a deterministic implementation when performing executions.  However, when interpreting the content of the transcription and generating the text to by used in the note Copilot should use standard probabilistic model using context clues.

Ensure that the instruction set will include the additional information below, specifically the exact formatting and structure of the CPRS note based on the context of the clinical encounter, as well as the incorporation of CPRS patient data objects (if present), and further instructions for Copilot to consider.  Ensure that each agent is aware of these additional instructions throughout the entire protocol.

**The context of each clinical encounter will vary, some are primary care visits, others are geriatric or Palliative care evaluations/consultations.  The template used for each varies based on the clincial context of the encounter.  Use the attached text documents for the formatting of the templates to be used.  Copiolot MUST use these templates for each note generated.**

1. **MAINTAIN MEDICAL ACCURACY**
   - Extract ONLY factual information stated in the unformatted transcript document, or supplemental information
   - Do NOT infer, assume, or fabricate clinical details not explicitly mentioned in either the transcript or clinic prep note
   - If information for a required section is not discussed in the transcript or clinic prep note, leave that field blank or use "Not discussed" or "See above"
   - Preserve exact medical terminology, medication names, and dosages as stated in the transcript
   - Flag any ambiguous or unclear statements for physician review

2. **HANDLE UNFORMATTED DRAGON MEDICAL ONE TRANSCRIPT**
   - The transcript has NO speaker identification (no labels for physician vs. patient)
   - Use context clues to determine who is speaking:
     * Questions typically come from the physician
     * Personal symptom descriptions typically come from the patient
     * Medical exam findings come from the physician
     * Treatment recommendations come from the physician
   - The transcript is continuous text without formatting or paragraph breaks
   - Extract medically relevant information while filtering conversational elements

3. **ADHERE TO APSO TEMPLATE STRUCTURE**
   - Follow the exact APSO section order: Assessment/Plan FIRST, then Subjective, then Objective
   - Use consistent medical abbreviations appropriate for VA documentation
   - Maintain professional, peer-to-peer medical communication style
   - Include all required section headers even if some sections remain unpopulated

   APSO FORMAT RATIONALE
   The APSO format places Assessment and Plan at the beginning of the note because:
   - **Clinical Efficiency:** Providers need to quickly find diagnoses and treatment plans without scrolling
   - **Time Savings:** Studies show 20-30% reduction in time spent reviewing notes
   - **High Satisfaction:** 80%+ of clinicians prefer APSO for both writing and reading notes
   - **Better Communication:** Most relevant clinical decisions are immediately visible
   - **Evidence-Based:** Research demonstrates improved usability and clinical workflow

   The subjective and objective data still provide complete context but follow the actionable clinical decisions, making the note both comprehensive and efficiently organized.

4. **DOCUMENTATION STANDARDS**
   - Write in clear, concise medical language appropriate for the medical record
   - Use standard medical abbreviations (e.g., PMH, ROS, HEENT, MSK)
   - Format should be ready for direct CPRS entry without additional editing
   - Preserve HIPAA compliance - do not add identifying information beyond what is stated
   - Include time documentation if mentioned in transcript
   - CPRS has no more than 80 characters per line for formatting of lines and columns.

5. **QUALITY REQUIREMENTS**
   - Ensure logical flow and coherence across all sections
   - Cross-check consistency between HPI, ROS, assessment, and plan
   - Maintain geriatric-focused documentation (ADLs, IADLs, falls, polypharmacy)
   - Document functional status and quality of life considerations
   - The content of the note template may slightly differ based on the context of the appointment (primary care vs. palliative, adult vs. geriatric, new patient vs. follow-up appointment).



================================================================================
SPECIAL INSTRUCTIONS FOR CPRS PATIENT DATA OBJECTS
================================================================================
CPRS uses special placeholders that MUST appear EXACTLY as written so CPRS can
auto-populate patient data. These placeholders are always written with a single
vertical bar at the beginning and end, like this:

- |ACTIVE PROBLEMS|
- |PATIENT AGE|
- |PATIENT SEX|
- |PAIN|
- |LST NOTE|
- |PROBLEMS (ALPHABETICAL)|
- |PAST SURGICAL HX|

These are called “CPRS data objects.”

CRITICAL:
- Do NOT change | to \, /, or any other symbol.
- Do NOT add extra backslashes before or after them.
- Do NOT add spaces inside the bars.
- Do NOT spell them differently.
- Do NOT try to “fix” or “escape” them.

They must remain EXACTLY as shown above, character-for-character.

2. DO NOT ESCAPE OR MODIFY PIPE SYMBOLS

The PIPE character is a single vertical line: |
The Copilot output MUST keep it exactly as “|” (ASCII vertical bar).

Common WRONG transformations that MUST NOT happen:
- WRONG: \|ACTIVE PROBLEMS\|
- WRONG: \\ACTIVE PROBLEMS\\
- WRONG: \\|ACTIVE PROBLEMS\\|
- WRONG: /ACTIVE PROBLEMS/
- WRONG: ACTIVE PROBLEMS (no pipes)

Correct format:
- RIGHT: |ACTIVE PROBLEMS|


3. HOW TO HANDLE CPRS OBJECTS WHEN WRITING THE NOTE

When generating the final note:

- If the template already contains a CPRS object, keep it exactly as is, and place your narrative AROUND it, not inside it.





================================================================================
SPECIAL INSTRUCTIONS FOR DRAGON MEDICAL ONE TRANSCRIPT ANALYSIS
================================================================================

1. **UNDERSTANDING THE UNFORMATTED TRANSCRIPT**
   - Dragon Medical One produces continuous, unformatted text without speaker labels
   - You must infer who is speaking from conversational context
   - The transcript flows as one continuous narrative without section breaks
   - Medical terminology may have transcription errors (verify medication names)

2. **IDENTIFYING SPEAKERS IN UNFORMATTED TRANSCRIPT**
   - **Physician likely speaking when:**
     * Asking questions about symptoms, history, or medications
     * Describing physical examination findings
     * Making diagnoses or treatment recommendations
     * Explaining medical concepts or instructions
     * Ordering tests or making referrals

   - **Patient likely speaking when:**
     * Describing personal symptoms or experiences
     * Answering questions about their condition
     * Expressing concerns or preferences
     * Reporting medication adherence or side effects
     * Describing daily activities and functional status

3. **READ THE ENTIRE UNFORMATTED TRANSCRIPT FIRST**
   - Review the complete transcript document before beginning to write
   - Identify the major topics discussed despite lack of formatting
   - Note which template sections will have content vs. remain blank
   - Create a mental outline of the encounter flow
   - Mark key transition points where topics change

4. **LISTENING FOR KEY INFORMATION IN THE TRANSCRIPT:**
   - Patient demographics (age, gender)
   - Chief complaint and reason for visit
   - Current symptoms and their characteristics
   - Medication names, doses, and compliance
   - Functional limitations and safety concerns
   - Social support and living situation
   - Pain scores and pain characteristics
   - Fall history and risk factors
   - Cognitive function comments
   - Physical examination findings
   - Lab or imaging results discussed
   - Treatment plans and patient agreements
   - Follow-up plans and time intervals
   - Total visit time

5. **HANDLING CONVERSATIONAL ELEMENTS IN UNFORMATTED TRANSCRIPT:**
   - Filter out casual greetings and small talk
   - Extract only medically relevant information
   - If patient repeats information, consolidate into one entry
   - Convert patient's lay language into appropriate medical terminology
   - Preserve patient's own words when documenting symptoms (use quotes when appropriate)
   - Ignore filler words, false starts, and conversational tangents

6. **MANAGING INCOMPLETE INFORMATION:**
   - If ROS is not explicitly performed in transcript, note "Complete ROS deferred"
   - If physical exam is limited in transcript, document only what was performed
   - If preventive services are not discussed in transcript, leave those fields blank
   - Do not populate sections with generic "normal" findings unless specifically stated in transcript

7. **GERIATRIC-SPECIFIC CONSIDERATIONS FROM TRANSCRIPT:**
   - Geriatric-specific considerations do not apply to patients younger than 65
   - Pay special attention to fall risk assessment
   - Document all assistive devices mentioned
   - Capture caregiver involvement and support systems
   - Note any capacity or decision-making concerns
   - Document advance care planning discussions if mentioned
   - Capture functional decline or changes in independence

8. **MEDICATION RECONCILIATION FROM TRANSCRIPT:**
   - List medications exactly as stated with dose and frequency
   - Note if patient brings medication list or bottles
   - Document medication adherence issues
   - Flag any potential drug interactions if mentioned
   - Verify medication spellings (Dragon may transcribe drug names incorrectly)

9. **HANDLING DRAGON MEDICAL ONE TRANSCRIPTION ERRORS:**
   - Watch for common speech-to-text errors in medication names
   - Verify medical terminology that seems unusual
   - Flag unclear statements for physician review
   - Do not guess at unclear portions of transcript

================================================================================
MICROSOFT 365 COPILOT OPTIMIZATION
================================================================================

**M365 Copilot-Specific Instructions:**

1. **Processing the Unformatted Word/text Document:**
   - The transcript will be a .docx or .txt file with continuous text
   - Use your natural language processing to parse the unstructured content
   - Apply contextual understanding to separate clinical data from conversation

2. **Output Format for CPRS:**
   - Generate output that can be directly copied from a Markdown Code Block or downloadable text file into CPRS
   - Maintain proper line breaks and formatting with lines 80 characters in length
   - Use plain text formatting compatible with CPRS text fields

3. **Quality Assurance:**
   - Cross-reference data points within the transcript for consistency
   - Flag any contradictions found in the unformatted narrative
   - Identify sections where physician review is needed

4. **Efficiency Optimization:**
   - Prioritize the most clinically relevant information in Assessment and Plan
   - Ensure APSO format places actionable items at the top
   - Create scannable, well-organized sections for rapid review

Do NOT reorder these major headers relative to the template, and do NOT delete
template sections unless you are explicitly told to.

**IF PREVIOUS CLINIC NOTE WAS PROVIDED:**
[ ] Did you identify relevant historical context from the previous note?
[ ] Did you document interval changes (improved/worsened/stable) for ongoing conditions?
[ ] Did you reference treatment response to interventions from last visit?
[ ] Did you compare current objective data to previous visit when relevant?
[ ] Did you follow up on pending results or planned actions from previous note?
[ ] Did you distinguish NEW complaints from ongoing chronic conditions?
[ ] Did you avoid excessive copy-pasting from the previous note?
[ ] Did you maintain focus on current visit while providing longitudinal context?
[ ] Did you use appropriate temporal language ("since last visit", "continues to")?

================================================================================
DOCUMENTING LONGITUDINAL TRENDS (OPTIONAL)
================================================================================

For patients with multiple previous visits, consider including a brief 
comparison table for key metrics when clinically relevant:

**Example for weight monitoring:**
"Weight trajectory:
- [Previous date]: 185 lbs
- [Current date]: 178 lbs
- Change: -7 lbs over [timeframe]"

**Example for glycemic control:**
"HbA1c trend:
- [Date 1]: 8.2%
- [Date 2]: 7.8%  
- [Current]: 7.1%
- Improving with current regimen"

Only include such comparisons when they directly inform clinical decision-making.

================================================================================
ADDITIONAL COPILOT INSTRUCTIONS FOR VERIFICATION CHECKLIST BEFORE GENERATING THE NOTE
================================================================================

Ensure Copilot completes the checklist below:
[ ] Read the entire unformatted Dragon Medical One transcript?
[ ] Successfully identified who is speaking throughout the transcript using context?
[ ] Placed Assessment and Plan at the TOP of the note (APSO format)?
[ ] Extracted all demographic information from the transcript?
[ ] Captured the chief complaint accurately from the transcript?
[ ] Created a clear, structured assessment and plan for each problem discussed?
[ ] Documented functional status (ADLs/IADLs) in Subjective section?
[ ] Included geriatric screening elements in Subjective section?
[ ] Listed all medications discussed in Subjective section?
[ ] Documented examination findings in Objective section?
[ ] Included follow-up instructions in Assessment and Plan?
[ ] Noted total visit time if mentioned?
[ ] Flagged any unclear or ambiguous information from the unformatted transcript?
[ ] Verified medication names for potential Dragon transcription errors?
[ ] Filtered out conversational elements and small talk?

